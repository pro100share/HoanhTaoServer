--[[功能：成就系统数据库操作版本：v1.0作者：郭肇义时间：2012-04-12]]_G.CAchievementSystemDB = {}--创建系统数据库function CAchievementSystemDB:new(objDB, objSys, ObjHideDB)	local obj = {}	obj.m_ObjDB = objDB;	obj.m_ObjSys = objSys;		for i, v in pairs(CAchievementSystemDB) do		if type(v) == "function" then			obj[i] = v;		end;	end;	return obj;end;-----------------------------------------------------------------------------------------------接口-----------------------------------------------------------------------------------------------设置成就function CAchievementSystemDB:SetAchievement(tabData)	local bValidity, dwRoleID = self:CheckDBValidityAndGetRoleID();	if not bValidity then		_info("DB invalidity by CAchievementSystemDB:GetProgressData");		return false;	end;	local SqlCmd = self.m_ObjDB:CreateUpdateCmd('T_Role_Achievement_New')	SqlCmd.Fields.dwProgress = tabData.dwProgress or 0	SqlCmd.Fields.eState = tabData.eState or -1	SqlCmd.Fields.dwDate = tabData.dwDate or -1	SqlCmd.Wheres.dwRoleID = dwRoleID	SqlCmd.Wheres.dwAchievementID = tabData.dwAchievementID	SqlCmd:execute()end--添加成就function CAchievementSystemDB:AddAchievement(tabData)	local bValidity, dwRoleID = self:CheckDBValidityAndGetRoleID();	if not bValidity then		_info("DB invalidity by CAchievementSystemDB:GetProgressData");		return false;	end;	local SqlCmd = self.m_ObjDB:CreateInsertCmd('T_Role_Achievement_New')	SqlCmd.Fields.dwRoleID = dwRoleID	SqlCmd.Fields.dwAchievementID = tabData.dwAchievementID	SqlCmd.Fields.dwProgress = tabData.dwProgress or 0	SqlCmd.Fields.eState = tabData.eState or -1	SqlCmd.Fields.dwDate = tabData.dwDate or -1	SqlCmd:execute()endlocal function MakeActiveInfoToString(tbActList)	local str = "";	for _,dwID in pairs(tbActList)do	--for dwID,_ in pairs(tbActList)do		str = str..dwID..",";	end		return str;end;--存储成就勋章function CAchievementSystemDB:SaveAchievementMedal(tabData)	local bValidity, dwRoleID = self:CheckDBValidityAndGetRoleID();	if not bValidity then		_info("DB invalidity by CAchievementSystemDB:GetProgressData");		return false;	end;		local SqlCmd = self.m_ObjDB:CreateUpdateCmd('T_Role_AchieveMedal')	SqlCmd.Wheres.dwRoleID = dwRoleID	SqlCmd.Fields.strMedalList = MakeActiveInfoToString(tabData);		SqlCmd:execute()end;--存储额外点数function CAchievementSystemDB:SavePlusPoint(dwValue)	local bValidity, dwRoleID = self:CheckDBValidityAndGetRoleID();	if not bValidity then		_info("DB invalidity by CAchievementSystemDB:GetProgressData");		return false;	end;		local SqlCmd = self.m_ObjDB:CreateUpdateCmd('T_Role_AchieveMedal')	SqlCmd.Wheres.dwRoleID = dwRoleID;	SqlCmd.Fields.dwAchievePointPlus = dwValue;		SqlCmd:execute()end;-----------------------------------------------------------------------------------------------私有-----------------------------------------------------------------------------------------------检查系统数据库模块有效性function CAchievementSystemDB:CheckDBValidityAndGetRoleID()	if not self.m_ObjDB then		_info("self.m_ObjDB is null by CAchievementSystemDB");		return false;	end;	if not self.m_ObjSys then		_info("self.m_ObjSys is null by CAchievementSystemDB");		return false;	end;	local objPlayer = self.m_ObjSys:GetPlayer();	if not objPlayer then		_info("objPlayer is null by CAchievementSystemDB");		return false;	end;    local dwRoleID = objPlayer:GetRoleID();	if dwRoleID == 0 then		_info("dwRoleID == 0  by CAchievementSystemDB");		return false;	end;	return true, dwRoleID;end;---------------------------------------------------------------------------------------------