---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------激活/反激活----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------激活function CMountSystem:Activate(n_MountInstID)	local objPlayer = self:GetPlayer();	if not objPlayer then		_err("CMountSystem:Activate() get player err!!!");		return;	end;	--检测数据有效性	if n_MountInstID > 0 and n_MountInstID ~= self.n_ActiveMountID then		--判断激活条件		local mountInst = self:GetMountInst(n_MountInstID);		----如果为无效ID，则不处理		if mountInst then			----如果职业不符，则抛弃请求			if mountInst:GetNeedProp() > 0 and mountInst:GetNeedProp() ~= objPlayer:GetInfo().dwProf then return end;			----如果等级超出自身等级+不可激活差值，则抛弃请求			--if mountInst:GetLevel() > objPlayer:GetInfo().dwLevel + _G.CMountSystemConfig.CannotActivateLevelDelta then return end;			--激活			self.n_ActiveMountID = n_MountInstID;			--通知事件中心			objPlayer:GetSystem('CPlayerEventCenterSystem'):DoEvent(_G.enumPlayerEventType.EventMountActivate, 1);			--加成所有属性			self:AttributeChange();			--向客户端同步数据			objPlayer.MountSys_SynchronizeActiveMsg{				ActiveMountID = self.n_ActiveMountID;			};		end;	end;end;--[[--反激活function CMountSystem:InActivate()	if self.n_ActiveMountID > 0 then		--如果当前处于骑乘状态则下马		if self:GetState() then			self:RideDown();		end;		self.n_ActiveMountID = 0;		--减所有加成属性		self:AttributeChange();		--向客户端同步数据		objPlayer.MountSys_SynchronizeActiveMsg{			ActiveMountID = self.n_ActiveMountID;		};	end;end;]]--坐骑变化影响人物属性变化function CMountSystem:AttributeChange()	local objPlayer = self:GetPlayer();	if not objPlayer then		_err("CMountSystem:AttributeChange() get player err!!!");		return;	end;	if self.SkillSystem then		local t_attr = _G.SSingleAttrChange:new();		if self.n_ActiveMountID > 0 then			local mountInst = self:GetMountInst(self.n_ActiveMountID);			if mountInst then				t_attr.dwHPMax	= mountInst:GetAddShengMing();	--生命max				t_attr.dwMPMax	= mountInst:GetAddNeiLi();		--内力max				t_attr.dwAttack	= mountInst:GetAddGongJi();		--攻击				t_attr.dwDefense= mountInst:GetAddFangYu();		--防御				t_attr.dwFlee	= mountInst:GetAddShenFa();		--身法				t_attr.dwCrit	= mountInst:GetAddBaoJi();		--暴击				if self:GetState() then					t_attr.dwMoveSpeed = mountInst:GetAddSpeedValue();		--移动速度				end;				-- for k, v in pairs(mountInst.t_Skill) do					-- _G.MountSkill[k]:Action_S(v, t_attr);				-- end;				for k, v in ipairs(mountInst.t_Equip) do					local itemInst = self.ItemSystem:GetItem(v);					if itemInst then						local attr = itemInst:GetAddAttr();						t_attr:AddValue(attr);					else						if v > 0 then							mountInst.t_Equip[k] = 0;							-- objPlayer.MountSys_SynchronizeEquipMsg{								-- MountInstID = self.n_ActiveMountID;								-- EquipPos	= k;								-- EquipID		= 0;							-- };						end;					end;				end;				--local changeRankAttr = _G.CMountBasePropConfig.AddChangeRankAttr(mountInst)				--t_attr:AddValue(changeRankAttr);				-----转生属性加成				local changeRankAttr = self:AddProChangeRankAttr(#mountInst:GetChangeRank());				t_attr:AddValue(changeRankAttr);			end;						--如果是跨服战 坐骑系统只同步速度属性 			if CConfig.bIsCrossSvr then				local tempSpeed = t_attr.dwMoveSpeed;				t_attr = _G.SSingleAttrChange:new();				t_attr.dwMoveSpeed = tempSpeed;			end						self.SkillSystem:NotifyMountUpdate(t_attr,1);		else			self.SkillSystem:NotifyMountUpdate(t_attr,1);		end;	end;end;--跨服战返回后同步坐骑速度function CMountSystem:CrossSrvSpeedChange()	local objPlayer = self:GetPlayer();	if not objPlayer then		_err("CMountSystem:AttributeChange() get player err!!!");		return;	end;	if self.SkillSystem then		local t_attr = _G.SSingleAttrChange:new();		if self.n_ActiveMountID > 0 then			local mountInst = self:GetMountInst(self.n_ActiveMountID);			if mountInst then				t_attr.dwHPMax	= mountInst:GetAddShengMing();	--生命max				t_attr.dwMPMax	= mountInst:GetAddNeiLi();		--内力max				t_attr.dwAttack	= mountInst:GetAddGongJi();		--攻击				t_attr.dwDefense= mountInst:GetAddFangYu();		--防御				t_attr.dwFlee	= mountInst:GetAddShenFa();		--身法				t_attr.dwCrit	= mountInst:GetAddBaoJi();		--暴击				if self:GetState() then					t_attr.dwMoveSpeed = mountInst:GetAddSpeedValue();		--移动速度				end;				-- for k, v in pairs(mountInst.t_Skill) do					-- _G.MountSkill[k]:Action_S(v, t_attr);				-- end;				for k, v in ipairs(mountInst.t_Equip) do					local itemInst = self.ItemSystem:GetItem(v);					if itemInst then						local attr = itemInst:GetAddAttr();						t_attr:AddValue(attr);					else						if v > 0 then							mountInst.t_Equip[k] = 0;							-- objPlayer.MountSys_SynchronizeEquipMsg{								-- MountInstID = self.n_ActiveMountID;								-- EquipPos	= k;								-- EquipID		= 0;							-- };						end;					end;				end;				--local changeRankAttr = _G.CMountBasePropConfig.AddChangeRankAttr(mountInst)				--t_attr:AddValue(changeRankAttr);				-----转生属性加成				local changeRankAttr = self:AddProChangeRankAttr(#mountInst:GetChangeRank());				t_attr:AddValue(changeRankAttr);			end;						self.SkillSystem:NotifyCSMountUpdate(t_attr);		else			self.SkillSystem:NotifyMountUpdate(t_attr,1);		end;	end;end