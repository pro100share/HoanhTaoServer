_G.CLotterySystemManager = CSingle:new();CSingleManager:AddSingle(CLotterySystemManager);--存储所有标签的信息CLotterySystemManager.setTikcetList = {};--存储上次开奖的信息CLotterySystemManager.setLastDrawInfo = {};--存储本次开奖的信息CLotterySystemManager.setCurDrawInfo = {};function CLotterySystemManager:Create()	return trueendfunction CLotterySystemManager:RequestInitInfoFromKS()	CKernelApp.OnRequestLotteryInfoMsg	{		LineID = CKernelApp.dwLineID;	}end;function CLotterySystemManager:OnKSReConnect()	self:RequestInitInfoFromKS();end;function CLotterySystemManager:OnKSConnect()	self:RequestInitInfoFromKS();end;-----------------------------------------------------------------------------------------------------------------------外部函数-----------------------------------------------因为同步所有标签的信息量较大 所以这里格式化优化一下function CLotterySystemManager:FormatTicketsInfo()	local retTab = {};	for k, v in pairs(self.setTikcetList) do		retTab[k] = {v.dwRoleID, v.dwSelectedCount, v.dwDrawCount}	end	return retTabendfunction CLotterySystemManager:UpdateTicketList(dwSetTicketList)	self.setTikcetList = dwSetTicketList	local setNet = {};	for i, objPlayer in pairs(CPlayerManager.setAllPlayer) do		table.insert(setNet, objPlayer.objNet);	end;		local setTicketList = self:FormatTicketsInfo()	_groupcallout(setNet, "OnSyncLotteryTicketMsg", {SetTikcetList = setTicketList});endfunction CLotterySystemManager:UpdateLastDrawInfo(dwSetLastDrawInfo)	self.setLastDrawInfo = dwSetLastDrawInfo	local setNet = {};	for i, objPlayer in pairs(CPlayerManager.setAllPlayer) do		table.insert(setNet, objPlayer.objNet);	end;	_groupcallout(setNet, "OnSyncLotteryLastDrawMsg", {SetLastDrawInfo = self.setLastDrawInfo});endfunction CLotterySystemManager:UpdateCurDrawInfo(dwSetCurDrawInfo)	self.setCurDrawInfo = dwSetCurDrawInfo	local setNet = {};	for i, objPlayer in pairs(CPlayerManager.setAllPlayer) do		table.insert(setNet, objPlayer.objNet);	end;	_groupcallout(setNet, "OnSyncLotteryCurDrwaMsg", {SetCurDrawInfo = self.setCurDrawInfo});end--同步标签的信息function CLotterySystemManager:SyncTicketsInfo(objPlayer)	local setTicketList = self:FormatTicketsInfo()	objPlayer.OnSyncLotteryTicketMsg{SetTikcetList = setTicketList}end--同步上次中奖信息function CLotterySystemManager:SyncLastDrawInfo(objPlayer)	objPlayer.OnSyncLotteryLastDrawMsg{SetLastDrawInfo = self.setLastDrawInfo}end--同步本次中奖信息function CLotterySystemManager:SyncCurDrawInfo(objPlayer)	objPlayer.OnSyncLotteryCurDrwaMsg{SetCurDrawInfo = self.setCurDrawInfo}endfunction CLotterySystemManager:IsTicketAlreadyBuy(dwTicketIndex)	local isAlreadyBuy = false	local buyRoleId = {}	local retRoleId = {}		buyRoleId = self.setTikcetList[dwTicketIndex].dwRoleID			for k, roleId in pairs(buyRoleId) do 		if roleId ~= 0 then			isAlreadyBuy = true			table.insert(retRoleId, roleId)		end	end	return isAlreadyBuy, retRoleId endfunction CLotterySystemManager:UpdateSingleTikcet(dwTicketIndex, dwRoleID, dwSelectedCount, dwDrawCount)	self.setTikcetList[dwTicketIndex] = {dwIndex = dwTicketIndex, dwRoleID = dwRoleID, dwSelectedCount = dwSelectedCount, dwDrawCount = dwDrawCount};		local setNet = {};	for i, objPlayer in pairs(CPlayerManager.setAllPlayer) do		if objPlayer:GetRoleID() == dwRoleID[1] and LotteryConfig.BuySuccessGiftEnumId ~= 0 then			--给购买标签的人 购买成功礼包			local setAddList = {};			local tempTabel = {				dwItemEnum	= LotteryConfig.BuySuccessGiftEnumId;				dwItemNumber= 1;				dwBindType = _G.enItemBindType.eYes;			}			table.insert(setAddList, tempTabel);			objPlayer:GetSystem('CItemSystem'):AddEnumItemListToPacket(setAddList, _G.ItemSysOperType.Lottery);		end		table.insert(setNet, objPlayer.objNet);	end;	_groupcallout(setNet, "CltLotteryTicketChangeMsg", {Index = dwTicketIndex, RoleID = dwRoleID, SelectedCount = dwSelectedCount, DrawCount = dwDrawCount});end--给客户端发送开奖消息function CLotterySystemManager:Draw()	local setNet = {};	for i, objPlayer in pairs(CPlayerManager.setAllPlayer) do		table.insert(setNet, objPlayer.objNet);	end;	_groupcallout(setNet, "CltLotteryDrawMsg", {});end--给客户端发送剩余标签数量消息 客户端广播用function CLotterySystemManager:RemainTicket()	local setNet = {};	for i, objPlayer in pairs(CPlayerManager.setAllPlayer) do		table.insert(setNet, objPlayer.objNet);	end;	_groupcallout(setNet, "CltLotteryRemainTicketMsg", {});end