--[[	掉落配置节点	周长沙	2012-3-12--]]_G.CConfigNode = {}--[[任务Id、权重、集合索引id、概率、数量下限、数量上限、物品id、品质--]]--构造函数function CConfigNode:new(tbInfo)	local obj = {}	obj.dwTaskId = tonumber(tbInfo.dwTaskId)				--任务id	obj.dwPriority = tonumber(tbInfo.dwPriority)			--权重	obj.dwTeamId = tonumber(tbInfo.dwTeamId)				--集合索引id	obj.dwProbability = tonumber(tbInfo.dwProbability)		--概率	obj.dwMin = tonumber(tbInfo.dwMin)						--数量下限	obj.dwMax = tonumber(tbInfo.dwMax)						--数量上限	obj.dwItemId = tonumber(tbInfo.dwItemId)				--物品id	obj.dwQuality = tonumber(tbInfo.dwQuality)				--品质	obj.dwStrongMin = tonumber(tbInfo.dwStrongMin)			--强化下限	obj.dwStrongMax = tonumber(tbInfo.dwStrongMax)			--强化上限	obj.dwBindType = tonumber(tbInfo.dwBindType)			--绑定类型	for k,v in pairs(CConfigNode) do		if type(v)=="function" then			obj[k] = v		end	end	return objend----------------------------------------------------------------------------------------------是否有权重function CConfigNode:IsSingle()	if self.dwPriority==0 then		return true	end	return falseend--返回权重值function CConfigNode:GetPriority()	return self.dwPriorityend--返回集合索引idfunction CConfigNode:GetTeamId()	return self.dwTeamIdend--返回概率function CConfigNode:GetProbability()	return self.dwProbabilityend--返回数值信息(礼包用)function CConfigNode:GetValueInfo()	local Temp = {}	Temp.dwPriority = self.dwPriority	--权重	Temp.dwNum = math.random(self.dwMin,self.dwMax)	--数量	Temp.dwItemId = self.dwItemId		--物品id	Temp.dwQuality = self.dwQuality		--品质	return Tempend--------------------------------------执行掉落function CConfigNode:DoDrop(dwRoleId,dwLevel,dwQuality,dwPer)	if dwQuality==0 then dwQuality = nil end;	local dwQuality = dwQuality or self.dwQuality	local dwPer = dwPer or 1	if self.dwTaskId ~= 0 then		dwPer = 1	end	local dwRoleId = dwRoleId or 0	local dwLevel = dwLevel or 1	local dwTeamId = self:GetTeamId()	if dwTeamId and dwTeamId~=0 then		local dwProbability = self.dwProbability * dwPer		local dwRand = math.random(1,10000)		if dwProbability>=dwRand then			local Team = CDropControl:GetDrop(dwTeamId)			if Team then				return Team:DoDrop(dwRoleId,dwLevel,dwQuality)			end		end	else		local dwProbability = self.dwProbability * dwPer		local dwRand = math.random(1,10000)		if dwProbability>=dwRand then			local dwMin = self.dwMin			local dwMax = self.dwMax			local dwNum = math.random(dwMin,dwMax)			local dwItemEnum = self.dwItemId			local dwStrong = math.random(self.dwStrongMin or 0,self.dwStrongMax or 0)						local dwTaskId = self.dwTaskId			local dwRoleId = dwRoleId			if CGlobalItemManager:IsEquip(dwItemEnum) and dwNum > 0 then				local tbDrop = {}				for i=1,dwNum do					dwStrong = DropFunctionConfig:GetDropStrong(dwItemEnum,self.dwStrongMin or 0,self.dwStrongMax or 0) or 0					table.insert(tbDrop,{dwItemEnum=dwItemEnum;dwNum=1;dwQuality=dwQuality;dwStrong=dwStrong;dwTaskId=dwTaskId;dwRoleId=dwRoleId;dwBindType=self.dwBindType})				end				return tbDrop			elseif dwNum >0 then				return {{dwItemEnum=dwItemEnum;dwNum=dwNum;dwQuality=dwQuality;dwTaskId=dwTaskId;dwRoleId=dwRoleId;dwBindType=self.dwBindType}}			else				return {}			end		end	end	return {}end--返回Node包含的物品function CConfigNode:DoGet(dwLevel,dwQuality)	local dwLevel = dwLevel or 1	local dwTeamId = self:GetTeamId()	if dwTeamId and dwTeamId~=0 then		local Team = CDropControl:GetDrop(dwTeamId)		if Team then			return Team:DoAllGet(dwLevel,dwQuality)		end	else		local dwMin = self.dwMin		local dwMax = self.dwMax		local dwNum = math.random(dwMin,dwMax)		local dwItemEnum = self.dwItemId		if dwQuality==0 then dwQuality = nil end;		local dwQuality = dwQuality or self.dwQuality		local dwStrong = math.random(self.dwStrongMin or 0,self.dwStrongMax or 0)		if CGlobalItemManager:IsEquip(dwItemEnum) and dwNum > 0 then			local tbDrop = {}			for i=1,dwNum do				table.insert(tbDrop,{dwItemEnum=dwItemEnum;dwNum=1;dwQuality=dwQuality;dwStrong=dwStrong;dwTaskId=dwTaskId;dwRoleId=dwRoleId})			end			return tbDrop		elseif dwNum >0 then			return {{dwItemEnum=dwItemEnum;dwNum=dwNum;dwQuality=dwQuality;dwTaskId=dwTaskId;dwRoleId=dwRoleId}}		else			return {}		end	end	return {}end