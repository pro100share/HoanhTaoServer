--[[功能：装备强化系统类型：继承于CSystem类，用来强化装备。版本：	v1.0	2012-02-16	 create by lkj]]_G.CEquipIntensifySystem = {};function CEquipIntensifySystem:new()	local obj = CSystem:new("CEquipIntensifySystem");	obj.ItemSystem = nil;	for index, value in pairs(CEquipIntensifySystem) do		if type(value) == "function" then			obj[index] = value;		end;	end;	return obj;end;-----------------------------------------------------------------------------------------------------------------------------------------------function CEquipIntensifySystem:Create()	--每个系统创建时都会挂接到自己的管理者player身上	local objPlayer = self:GetPlayer();	if not objPlayer then		_err("CEquipIntensifySystem Create Cannot get player----");		return false;	end;	--装备强化系统是上层系统，需要调用player的基础道具系统	self.ItemSystem = objPlayer:GetSystem("CItemSystem");	if not self.ItemSystem then		_err("CEquipIntensifySystem Create Cannot get itemsystem----");		return false;	end;	--天官赐福系统	self.TianGuanCiFuSystem = objPlayer:GetSystem("CTianGuanCiFuSystem");	if not self.TianGuanCiFuSystem then		_err("CEquipIntensifySystem Create Cannot get TianGuanCiFuSystem----");		return false;	end;	self.CZItemInstId = nil;	self.newCZProp = nil;		--折扣	self.nDiscount_Intensify= 1;--强化折扣	self.nDiscount_LevelUp	= 1;--升阶折扣	self.nDiscount_Append	= 1;--重置附加属性折扣	self.nDiscount_ResetType= 1;--重置属性类型折扣	self.nDiscount_AddValue = 1;--增加属性数值折扣		return true;end;function CEquipIntensifySystem:Destroy()end;--------------------------------------------------------------------------------------------------------------------------------------------------死亡function CEquipIntensifySystem:OnDead(dwEnemyType,dwEnemyID)	self:OnClose();end;--换线回调function CEquipIntensifySystem:OnChangeGameLine()	self:OnClose();end;function CEquipIntensifySystem:OnClose()	local objPlayer = self:GetPlayer();	if not objPlayer then		_err("CEquipIntensifySystem Cannot get player OnClose");		return;	end;	objPlayer.EISys_OnCloseMsg{};end;----OnEnterScene()function CEquipIntensifySystem:OnEnterScene()	self:SynTianGuanCiFu();	local objPlayer = self:GetPlayer();	if objPlayer then		CExaminationMgr:GetPlayerInfo(objPlayer)	end;end;--EventGetAuthority()function CEquipIntensifySystem:EventGetAuthority(szAuthName)	if szAuthName == "CenFuZi" then		local objPlayer = self:GetPlayer();		if objPlayer then			CExaminationMgr:GetPlayerInfo(objPlayer)		end;	endend;--同步天官赐福值function CEquipIntensifySystem:SynTianGuanCiFu()	local objPlayer = self:GetPlayer();	if not objPlayer then		_err("CEquipIntensifySystem Cannot get player SynTianGuanCiFu");		return;	end;	--装备升阶天官赐福	local n_Value = self.TianGuanCiFuSystem:Get_EquipUpGrade();	objPlayer.EISys_SynTianGuanCiFuMsg{EquipUpGrade = n_Value};end;------------------------------------------------------------------------------------------------------------------------------------------------function CEquipIntensifySystem:CheckInTable(t_Table, n_Pos)	for k, v in pairs(t_Table) do		if n_Pos == v then			return true;		end;	end;	return false;end;--------------------------------------------------------------------------------------------------------------------------------------------------广播消息function CEquipIntensifySystem:BroadCastMsg(itemInst, n_Type, info)	local objPlayer = self:GetPlayer();	if not objPlayer then		_err("Cannot get player on CEquipIntensifySystem:BroadCastMsg");		return;	end;	--玩家姓名	local s_PlayerName = objPlayer:GetInfo().szRoleName;	--玩家RoleID	local n_PlayerRoleID = objPlayer:GetInfo().dwRoleID;	--装备网络信息	local itemNetData = itemInst:GetNetData();	-- itemInst:FillItemMessage(itemNetData);	-- itemNetData = CItemSystem:KeyNameToNumber({itemNetData});	--信息类型 n_Type	---- 1 装备强化	---- 2 装备重置附加属性	---- 3 装备天生属性强化(兵魂)	---- 4 装备升阶	---- 5 装备附加属性类型重置	---- 6 装备附加属性数值强化	--全服广播	CGameApp.EISys_BroadCastMsg{Type = n_Type, PlayerName = s_PlayerName, PlayerRoleID = n_PlayerRoleID, ItemNetData = itemNetData, Info = info};end;