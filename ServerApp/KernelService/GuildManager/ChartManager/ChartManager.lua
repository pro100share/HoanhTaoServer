---------------------------------------------------------------------------------公会榜单数据-------------------------------------------------------------------------------_G.CGuildChart = CGuildData:inherit()function CGuildChart:Create(tabInfo)	self.dwGuildID = tabInfo.dwGuildID --公会ID	self.eChart = tabInfo.eChart --榜单	self.dwCount  = tabInfo.dwCount or 0 --人数end---------------------------------------------------------------------------------公会榜单系统-------------------------------------------------------------------------------_G.CGuildChartMgr = CGuildBaseMgr:inherit()function CGuildChartMgr:Create()	self.tabDataMap = CGuildMutiMap:new(2)	local fn = function(objGuild)		local dwGuildID = objGuild.dwGuildID		for _,eChart in pairs(ChartSwitch) do			local objChart = CGuildChart:new()			objChart.dwGuildID = dwGuildID			objChart.eChart = eChart			self:Add(objChart)		end	end	CGuildInfoMgr:Iterator(fn)	for _,eChart in pairs(ChartSwitch) do		local dwNumber = GuildChartConfig.dwNumber		local tabChart = CChartManager:GetChartList(eChart,1,dwNumber)		self:InitChart(eChart,tabChart)	endendfunction CGuildChartMgr:Add(objChart)	local dwGuildID = objChart.dwGuildID	local eChart = objChart.eChart	self.tabDataMap:Set(dwGuildID,eChart,objChart)	return objChartendfunction CGuildChartMgr:Get(dwGuildID,eChart)	return self.tabDataMap:Get(dwGuildID,eChart)endfunction CGuildChartMgr:Del(dwGuildID,eChart)	local objChart = self.tabDataMap:Get(dwGuildID,eChart)	if not objChart then return end	self.tabDataMap:Set(dwGuildID,eChart,nil)	return objChartend-------------------------------------------------------------------------------function CGuildChartMgr:InitChart(eChart,tabChart)	for dwNumber,tabInfo in ipairs(tabChart) do		local dwRoleID = tabInfo.dwRoleID		local objMember = CGuildMemberMgr:Get(dwRoleID)		if objMember then			local dwGuildID = objMember.dwGuildID			local objChart = self:Get(dwGuildID,eChart)			if objChart then  				objChart.dwCount = objChart.dwCount + 1			end;		end		if dwNumber > GuildChartConfig.dwNumber then break end	endendfunction CGuildChartMgr:UpdateChart(eChart,tabChart)	local tabModify = {}	local fn = function(objChart)		if objChart.eChart == eChart then			objChart.dwCount = 0			tabModify[objChart.dwGuildID] = 0		end	end	self.tabDataMap:Iterator(fn)	self:InitChart(eChart,tabChart)	local fn = function(objChart)		if objChart.eChart == eChart then			tabModify[objChart.dwGuildID] = objChart.dwCount		end	end	self.tabDataMap:Iterator(fn)	for dwGuildID,dwCount in pairs(tabModify) do		local tabRefresh = {{ eChart,dwCount }}		CGuildPlayerMsg:NotifyGuild(dwGuildID,'OnRefreshChartList',tabRefresh)	endendfunction CGuildChartMgr:GetChartList(dwGuildID)	local tabList = {}	for _,eChart in pairs(ChartSwitch) do		local objChart = self:Get(dwGuildID,eChart)		tabList[eChart] = objChart.dwCount	end	return tabListend-------------------------------------------------------------------------------function CGuildChartMgr:Build(dwGuildID)	for _,eChart in pairs(ChartSwitch) do		local objChart = CGuildChart:new()		objChart.dwGuildID = dwGuildID		objChart.eChart = eChart		self:Add(objChart)	endendfunction CGuildChartMgr:Dismiss(dwGuildID)	for _,eChart in pairs(ChartSwitch) do		self:Del(dwGuildID,eChart)	endendfunction CGuildChartMgr:Join(dwRoleID)	local objMember = CGuildMemberMgr:Get(dwRoleID)	local dwGuildID = objMember.dwGuildID	local tabChart = CChartManager:GetChartRole(dwRoleID)	local tabRefresh = {}	local bFlag = false	for eChart,tabInfo in pairs(tabChart or {}) do		if tabInfo.dwNumber < GuildChartConfig.dwNumber then			local objChart = self:Get(dwGuildID,eChart)			objChart.dwCount = objChart.dwCount + 1			table.insert(tabRefresh,{ eChart,objChart.dwCount })			bFlag = true		end	end	if not bFlag then return end	CGuildPlayerMsg:NotifyGuild(dwGuildID,'OnRefreshChartList',tabRefresh)endfunction CGuildChartMgr:Quit(dwRoleID)	local objMember = CGuildMemberMgr:Get(dwRoleID)	local dwGuildID = objMember.dwGuildID	local tabChart = CChartManager:GetChartRole(dwRoleID)	local tabRefresh = {}	for eChart,tabInfo in pairs(tabChart or {}) do		if tabInfo.dwNumber < GuildChartConfig.dwNumber then			local objChart = self:Get(dwGuildID,eChart)			objChart.dwCount = objChart.dwCount - 1			table.insert(tabRefresh,{ eChart,objChart.dwCount })		end	end	if #tabRefresh == 0 then return end	CGuildPlayerMsg:NotifyGuild(dwGuildID,'OnRefreshChartList',tabRefresh)end-------------------------------------------------------------------------------