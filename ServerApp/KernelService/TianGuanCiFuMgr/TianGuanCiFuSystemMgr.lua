--[[功能：全局天官赐福管理器类型：继承于CSingle类，用来管理玩家天官赐福定时刷新版本：	v1.0	17:32 2012-7-11 create by lkj]]_G.CTianGuanCiFuMgr = CSingle:new();CSingleManager:AddSingle(CTianGuanCiFuMgr);--createfunction CTianGuanCiFuMgr:Create()		--初始化计时器	CAlarmClock:AddTask({dwTime = _G.TianGuanCiFuConfig.RefreshTime}, CAlarmTaskCycleType.eDay, 1, 0,		function() self:ResetValue() end, {}	)	return true;end;--updatefunction CTianGuanCiFuMgr:Update(dwInterval)	return true;end;--destroyfunction CTianGuanCiFuMgr:Destroy()end;------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------对外接口------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------function CTianGuanCiFuMgr:SynchFlag(flag)	self.flag = flag;end;--重置天官赐福function CTianGuanCiFuMgr:ResetValue()	CPlayerDBQuery:GetDBQuery():execute('UPDATE "T_Role_TianGuanCiFu" SET "n_EquipUpGrade2"="T_Role_TianGuanCiFu"."n_EquipUpGrade1", "n_AmuletUpGrade2"="T_Role_TianGuanCiFu"."n_AmuletUpGrade1", "n_JingJieUp2"="T_Role_TianGuanCiFu"."n_JingJieUp1", "n_MountUpGrade2"="T_Role_TianGuanCiFu"."n_MountUpGrade1", "n_SwordUpGrade2"="T_Role_TianGuanCiFu"."n_SwordUpGrade1", "n_EquipStrong2"="T_Role_TianGuanCiFu"."n_EquipStrong1", "n_MegaKill2"="T_Role_TianGuanCiFu"."n_MegaKill1"');	CPlayerDBQuery:GetDBQuery():execute('UPDATE "T_Role_TianGuanCiFu" SET "n_EquipUpGrade1"="T_Role_TianGuanCiFu"."n_EquipUpGrade", "n_AmuletUpGrade1"="T_Role_TianGuanCiFu"."n_AmuletUpGrade", "n_JingJieUp1"="T_Role_TianGuanCiFu"."n_JingJieUp", "n_MountUpGrade1"="T_Role_TianGuanCiFu"."n_MountUpGrade", "n_SwordUpGrade1"="T_Role_TianGuanCiFu"."n_SwordUpGrade", "n_EquipStrong1"="T_Role_TianGuanCiFu"."n_EquipStrong", "n_MegaKill1"="T_Role_TianGuanCiFu"."n_MegaKill"');		-- ActivityConfig.Exp[4].value ；--坐骑天官赐福不清除	-- ActivityConfig.Exp[5].value ；--实战天官赐福不清除	-- ActivityConfig.Exp[6].value ；--名剑天官赐福不清除	-- ActivityConfig.Exp[7].value ；--宝甲天官赐福不清除	-- ActivityConfig.Exp[8].value ；--易筋经天官赐福不清除	-- ActivityConfig.Exp[9].value ；--血魔功天官赐福不清除	-- ActivityConfig.Exp[10].value ；--装备升级天官赐福不清除	local t = {};	local str4 = ',"n_MountUpGrade"=0';	local str5 = ',"n_JingJieUp"=0';	local str6 = ',"n_SwordUpGrade"=0';	local str7 = ',"n_AmuletUpGrade"=0';	local str8 = ',"n_KungFuStudy"=0'	local str9 = ',"n_MegaKill"=0'	local str10 = ',"n_EquipUpGrade"=0';	local str11 = ',"n_HiddenWeapon"=0';	local str12 = ',"n_ZhanQiJue"=0';	local str13 = ',"n_GoldenBody"=0';	local str14 = ',"n_Banner"=0';		if self.flag and self.flag[4] then		t[4] = true;		str4 = '';	end;	if self.flag and self.flag[5] then		t[5] = true;		str5 = '';	end;	if self.flag and self.flag[6] then		t[6] = true;		str6 = '';	end;	if self.flag and self.flag[7] then		t[7] = true;		str7 = '';	end;	if self.flag and self.flag[8] then		t[8] = true;		str8 = '';	end;	if self.flag and self.flag[9] then		t[9] = true;		str9 = '';	end;	if self.flag and self.flag[10] then		t[10] = true;		str10 = '';	end;	if self.flag and self.flag[11] then		t[11] = true;		str11 = '';	end;	if self.flag and self.flag[12] then		t[12] = true;		str12 = '';	end;	if self.flag and self.flag[13] then		t[13] = true;		str13 = '';	end;	if self.flag and self.flag[14] then		t[14] = true;		str14 = '';	end;		local str = 'UPDATE "T_Role_TianGuanCiFu" SET "n_EquipStrong"=0%s%s%s%s%s%s%s%s%s%s%s';	str = string.format(str, str4, str5, str6, str7, str8, str9, str10, str11, str12, str13, str14);		--CPlayerDBQuery:GetDBQuery():execute('UPDATE "T_Role_TianGuanCiFu" SET "n_EquipUpGrade"=0, "n_AmuletUpGrade"=0, "n_JingJieUp"=0, "n_MountUpGrade"=0, "n_SwordUpGrade"=0, "n_EquipStrong"=0, "n_KungFuStudy"=0, "n_MegaKill"=0');	CPlayerDBQuery:GetDBQuery():execute(str);	for i,objLine in pairs(CGameLineManager:GetAllLine()) do		objLine.GSRemoteCallMsg{System = "CTianGuanCiFuSystem", Func = "ResetAll", Args = {t}};	end;end;----GM增加装备升阶天官赐福值function CTianGuanCiFuMgr:Add_EquipUpGrade_GM(value)	CPlayerDBQuery:GetDBQuery():execute('UPDATE "T_Role_TianGuanCiFu" SET "n_EquipUpGrade"="n_EquipUpGrade" + $1', value);	for i,objLine in pairs(CGameLineManager:GetAllLine()) do		objLine.GSRemoteCallMsg{System = "CTianGuanCiFuSystem", Func = "Add_EquipUpGradeValue", Args = {value, true}};	end;end;--GM增加护身宝甲升阶天官赐福值function CTianGuanCiFuMgr:Add_AmuletUpGrade_GM(value)	CPlayerDBQuery:GetDBQuery():execute('UPDATE "T_Role_TianGuanCiFu" SET "n_AmuletUpGrade"="n_AmuletUpGrade"+ $1', value);	for i,objLine in pairs(CGameLineManager:GetAllLine()) do		objLine.GSRemoteCallMsg{System = "CTianGuanCiFuSystem", Func = "Add_AmuletUpGradeValue", Args = {value, true}};	end;end;--GM增加坐骑升阶天官赐福值function CTianGuanCiFuMgr:Add_MountUpGrade_GM(value)	CPlayerDBQuery:GetDBQuery():execute('UPDATE "T_Role_TianGuanCiFu" SET "n_MountUpGrade"="n_MountUpGrade" + $1', value);	for i,objLine in pairs(CGameLineManager:GetAllLine()) do		objLine.GSRemoteCallMsg{System = "CTianGuanCiFuSystem", Func = "Add_MountUpGradeValue", Args = {value, true}};	end;end;--GM增加境界升级天官赐福值function CTianGuanCiFuMgr:Add_JingJieUp_GM(value)	CPlayerDBQuery:GetDBQuery():execute('UPDATE "T_Role_TianGuanCiFu" SET "n_JingJieUp"="n_JingJieUp" + $1', value);	for i,objLine in pairs(CGameLineManager:GetAllLine()) do		objLine.GSRemoteCallMsg{System = "CTianGuanCiFuSystem", Func = "Add_JingJieUpValue", Args = {value, true}};	end;end;--GM增加宝剑升级天官赐福值function CTianGuanCiFuMgr:Add_SwordUpGrade_GM(value)	CPlayerDBQuery:GetDBQuery():execute('UPDATE "T_Role_TianGuanCiFu" SET "n_SwordUpGrade"="n_SwordUpGrade" + $1', value);	for i,objLine in pairs(CGameLineManager:GetAllLine()) do		objLine.GSRemoteCallMsg{System = "CTianGuanCiFuSystem", Func = "Add_SwordUpGradeValue", Args = {value, true}};	end;end;--GM增加装备强化天官赐福值function CTianGuanCiFuMgr:Add_EquipStrong_GM(value)	CPlayerDBQuery:GetDBQuery():execute('UPDATE "T_Role_TianGuanCiFu" SET "n_EquipStrong"="n_EquipStrong" + $1', value);	for i,objLine in pairs(CGameLineManager:GetAllLine()) do		objLine.GSRemoteCallMsg{System = "CTianGuanCiFuSystem", Func = "Add_EquipStrongValue", Args = {value, true}};	end;end;